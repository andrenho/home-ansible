---
- name: Install and configure server
  hosts: server
  become: yes

  tasks:

    - name: Install server packages
      include_role:
        name: server-packages

    - name: Create AWS credentials
      include_role:
        name: server-aws-creds

    - name: Clone homeserver repository
      git:
        repo: "https://{{ git_username }}:{{ git_password }}@github.com/andrenho/homeserver.git"
        dest: "{{ homeserver_path }}"
        version: home-network   # TODO - remove

          #- name: Request certificate (first time)
          #include_role:
          #name: server-certbot

    - name: Configure data directory
      include_role:
        name: server-data-dir

    - name: Configure homeserver
      include_role:
        name: server-homeserver
