---

- name: Clone homeserver repository
  git:
    repo: "https://{{ git_username }}:{{ git_password }}@github.com/andrenho/homeserver.git"
    dest: "{{ homeserver_path }}"
    version: home-network   # TODO - remove

- name: Create env file
  template:
    src: docker-env
    dest: "{{ docker_env_file }}"
    mode: '0600'

- name: Create .htpasswd file
  htpasswd:
    mode: '0600'
    name: {{ admin_user }}
    password: {{ admin_password }}
    path: {{ htpasswd_file }}

- name: Create service
  template:
    src: docker-compose-app.service
    dest: /etc/systemd/system/docker-compose-app.service

- name: Start and enable service
  service:
    name: docker-compose-app
    state: restarted
    enabled: true
    daemon_reload: true

# TODO - create docker service and install/start service
